# 分支

分支的目的是让你当前的工作和主线上分开，直到你主动合并分支之前，你的工作和开发将不会影响到主线。Git 利用快照和提交对象，分支就是一个可移动的指针，指向了某一个提交对象。

## 新建分支

``` shell
# 采用缩写
# git branch draft
# git checkout draft
git checkout -b draft
```

---

新建分支（branch）参考 Pro Git 的[这一章节](https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E6%96%B0%E5%BB%BA%E4%B8%8E%E5%90%88%E5%B9%B6)绝大多少情况下，我们都是从“当前”分支新建，只需要执行下面的命令就可以。

``` 
git checkout -b 新分支名
```

将会自动新建和移动到对应的分支上。这一操作可以在 [Learn Git Branching](https://learngitbranching.js.org/?locale=zh_CN) 小游戏基础篇的第二个关卡学习和实验。

注：checkout 经常被翻译成检出，可以理解为是查看或者切换到某个分支的意思。

## 合并分支

快进：

只在一个分支上提交内容，每次在开发完功能后将分支上的操作合并到主分支上的情况，这种操作不会产生分支的合并记录，实际上只是移动了分支的指针，整体的提交日志依然是线性的，不会有分叉。

``` shell
# 将较新的分支内容合并到较旧的分支上
git checkout main
git merge draft

# 删除分支（对于不需要的分支，可以根据实际情况来进行删除）
git branch -d draft
```

如果是单纯的把后续的提交添加到之前的分支上，也就是在一条线性的没有分叉的提交线上移动分支，这时候只要检出到想要移动的分支上，然后使用 ```git merge``` 命令将当前分支的指针移动过去就可以。

---

没有冲突的三方合并：

这种一般是单人开发中经常遇到的情况，基于某一个结点（提交快照）建立了两个分支，在两个分支都开发和操作结束后，要将两个分支的内容都合并到主分支上的操作。这种情况下，合并的三方分别是两个分叉的终点和两个分叉的最近的共同祖先结点。

同时要注意的是，如果从原有的分支上分离出来了新的分支，并且原先的分支依旧在前进，这种情况也是属于三方合并的。此时的分支状态就相当于已经进行了一次快进，将主分支的指针向前移动到了某个分支的终点。但是不鼓励这种做法，如果原本分支的修改很容易产生可以影响到其他分支的冲突。

``` shell
# 先移动到主分支上
git checkout test

# 快速前进到第一个分支上
git merge test-1

# 和第二个分支触发三方合并
git merge test-2

# 合并结束后删除已经合并的分支
git branch -d test-1
git branch -d test-2
```

分支合并后的结果如下图：

![没有冲突的分支合并](img/merge-branch-without-conflict.jpg)

可以看出来，这样操作产生了分支合并的 Git 记录。等于说在 Git 的操作下，产生了一个新的快照，test-1 和 test-2 的最后一次提交是这个快照的两个父级，而 test 这个分支指针指向了这个自动产生的提交上。

以上操作可以查看本项目 test/1 文件夹中的内容。

---
